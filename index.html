<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 Goals Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const GoalsTracker = () => {
          const [goals, setGoals] = useState([
            { id: 1, name: 'Music', color: '#10b981' },
            { id: 2, name: 'Gym', color: '#3b82f6' },
            { id: 3, name: 'Dating', color: '#ec4899' },
            { id: 4, name: 'Friendships', color: '#f59e0b' },
            { id: 5, name: 'Business Ideas', color: '#8b5cf6' }
          ]);
          
          const [completions, setCompletions] = useState({});
          const [selectedDate, setSelectedDate] = useState(null);
          const [showSettings, setShowSettings] = useState(false);
          const [githubToken, setGithubToken] = useState('');
          const [gistId, setGistId] = useState('');
          const [isConfigured, setIsConfigured] = useState(false);
          const [syncStatus, setSyncStatus] = useState('');
          const [isLoading, setIsLoading] = useState(true);

          // Check for saved configuration
          useEffect(() => {
            const savedToken = localStorage.getItem('githubToken');
            const savedGistId = localStorage.getItem('gistId');
            
            if (savedToken && savedGistId) {
              setGithubToken(savedToken);
              setGistId(savedGistId);
              setIsConfigured(true);
              loadFromGist(savedToken, savedGistId);
            } else {
              // Fall back to localStorage if not configured
              const savedGoals = localStorage.getItem('goalsTrackerGoals');
              const savedCompletions = localStorage.getItem('goalsTrackerCompletions');
              
              if (savedGoals) setGoals(JSON.parse(savedGoals));
              if (savedCompletions) setCompletions(JSON.parse(savedCompletions));
              setIsLoading(false);
            }
          }, []);

          // Save to Gist whenever data changes (debounced)
          useEffect(() => {
            if (!isConfigured || isLoading) return;
            
            const timeoutId = setTimeout(() => {
              saveToGist();
            }, 1000); // Wait 1 second after last change before saving
            
            return () => clearTimeout(timeoutId);
          }, [goals, completions, isConfigured, isLoading]);

          const loadFromGist = async (token, gistIdToLoad) => {
            try {
              setSyncStatus('Loading...');
              const response = await fetch(`https://api.github.com/gists/${gistIdToLoad}`, {
                headers: {
                  'Authorization': `token ${token}`,
                  'Accept': 'application/vnd.github.v3+json'
                }
              });
              
              if (!response.ok) throw new Error('Failed to load from Gist');
              
              const gist = await response.json();
              const content = JSON.parse(gist.files['goals-data.json'].content);
              
              setGoals(content.goals);
              setCompletions(content.completions);
              setSyncStatus('✓ Synced');
              setIsLoading(false);
              
              setTimeout(() => setSyncStatus(''), 2000);
            } catch (error) {
              console.error('Error loading from Gist:', error);
              setSyncStatus('✗ Load failed');
              setIsLoading(false);
              setTimeout(() => setSyncStatus(''), 3000);
            }
          };

          const saveToGist = async () => {
            try {
              setSyncStatus('Saving...');
              
              const data = {
                goals,
                completions
              };
              
              const response = await fetch(`https://api.github.com/gists/${gistId}`, {
                method: 'PATCH',
                headers: {
                  'Authorization': `token ${githubToken}`,
                  'Accept': 'application/vnd.github.v3+json',
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  files: {
                    'goals-data.json': {
                      content: JSON.stringify(data, null, 2)
                    }
                  }
                })
              });
              
              if (!response.ok) throw new Error('Failed to save to Gist');
              
              setSyncStatus('✓ Synced');
              setTimeout(() => setSyncStatus(''), 2000);
            } catch (error) {
              console.error('Error saving to Gist:', error);
              setSyncStatus('✗ Save failed');
              setTimeout(() => setSyncStatus(''), 3000);
            }
          };

          const setupGitHub = async () => {
            const token = window.prompt('Enter your GitHub Personal Access Token:');
            if (!token) return;
            
            try {
              setSyncStatus('Setting up...');
              
              // Create a new gist
              const response = await fetch('https://api.github.com/gists', {
                method: 'POST',
                headers: {
                  'Authorization': `token ${token}`,
                  'Accept': 'application/vnd.github.v3+json',
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  description: '2026 Goals Tracker Data',
                  public: false,
                  files: {
                    'goals-data.json': {
                      content: JSON.stringify({
                        goals,
                        completions
                      }, null, 2)
                    }
                  }
                })
              });
              
              if (!response.ok) throw new Error('Failed to create Gist');
              
              const gist = await response.json();
              
              // Save configuration
              localStorage.setItem('githubToken', token);
              localStorage.setItem('gistId', gist.id);
              
              setGithubToken(token);
              setGistId(gist.id);
              setIsConfigured(true);
              setSyncStatus('✓ Connected!');
              
              setTimeout(() => setSyncStatus(''), 2000);
            } catch (error) {
              console.error('Error setting up GitHub:', error);
              alert('Failed to set up GitHub sync. Make sure your token has "gist" permissions.');
              setSyncStatus('');
            }
          };

          const disconnectGitHub = () => {
            if (!window.confirm('Disconnect GitHub sync? Your data will remain in the Gist, but won\'t sync anymore.')) return;
            
            localStorage.removeItem('githubToken');
            localStorage.removeItem('gistId');
            
            setGithubToken('');
            setGistId('');
            setIsConfigured(false);
            setSyncStatus('');
            
            // Save current state to localStorage
            localStorage.setItem('goalsTrackerGoals', JSON.stringify(goals));
            localStorage.setItem('goalsTrackerCompletions', JSON.stringify(completions));
          };

          const getDateKey = (date) => {
            return date.toISOString().split('T')[0];
          };

          const generateYearDates = () => {
            const dates = [];
            const startDate = new Date(2026, 0, 1);
            const endDate = new Date(2026, 11, 31);
            
            let currentDate = new Date(startDate);
            while (currentDate <= endDate) {
              dates.push(new Date(currentDate));
              currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return dates;
          };

          const getWeeksGrid = () => {
            const allDates = generateYearDates();
            const weeks = [];
            let currentWeek = [];
            
            const firstDate = allDates[0];
            const firstDay = firstDate.getDay();
            const daysToAdd = firstDay === 0 ? 6 : firstDay - 1;
            
            for (let i = 0; i < daysToAdd; i++) {
              currentWeek.push(null);
            }
            
            allDates.forEach(date => {
              currentWeek.push(date);
              if (currentWeek.length === 7) {
                weeks.push(currentWeek);
                currentWeek = [];
              }
            });
            
            if (currentWeek.length > 0) {
              while (currentWeek.length < 7) {
                currentWeek.push(null);
              }
              weeks.push(currentWeek);
            }
            
            return weeks;
          };

          const getCellColorForGoal = (date, goalId) => {
            if (!date) return 'transparent';
            
            const key = getDateKey(date);
            const dayCompletions = completions[key] || [];
            
            if (dayCompletions.includes(goalId)) {
              const goal = goals.find(g => g.id === goalId);
              return goal.color;
            }
            
            return '#ebedf0';
          };

          const getAggregateCellColor = (date) => {
            if (!date) return 'transparent';
            
            const key = getDateKey(date);
            const dayCompletions = completions[key] || [];
            const count = dayCompletions.length;
            
            if (count === 0) return '#ebedf0';
            if (count === 1) return '#9be9a8';
            if (count === 2) return '#40c463';
            if (count === 3) return '#30a14e';
            if (count === 4) return '#216e39';
            return '#0d4429';
          };

          const handleDayClick = (date) => {
            if (!date) return;
            setSelectedDate(date);
          };

          const toggleGoal = (goalId) => {
            const key = getDateKey(selectedDate);
            const current = completions[key] || [];
            
            const updated = current.includes(goalId)
              ? current.filter(id => id !== goalId)
              : [...current, goalId];
            
            setCompletions({
              ...completions,
              [key]: updated
            });
          };

          const addGoal = () => {
            const name = window.prompt('Goal name:');
            if (!name || name.trim() === '') return;
            
            const colors = ['#10b981', '#3b82f6', '#ec4899', '#f59e0b', '#8b5cf6', '#ef4444', '#06b6d4', '#84cc16'];
            const color = colors[goals.length % colors.length];
            
            setGoals([...goals, {
              id: Date.now(),
              name: name.trim(),
              color
            }]);
          };

          const removeGoal = (goalId) => {
            if (!window.confirm('Remove this goal? This will also remove all tracked data for this goal.')) return;
            
            setGoals(goals.filter(g => g.id !== goalId));
            
            const updatedCompletions = { ...completions };
            Object.keys(updatedCompletions).forEach(dateKey => {
              updatedCompletions[dateKey] = updatedCompletions[dateKey].filter(id => id !== goalId);
            });
            setCompletions(updatedCompletions);
          };

          const editGoalName = (goalId) => {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            const newName = window.prompt('Edit goal name:', goal.name);
            if (!newName || newName.trim() === '' || newName === goal.name) return;
            
            setGoals(goals.map(g => 
              g.id === goalId ? { ...g, name: newName.trim() } : g
            ));
          };

          if (isLoading) {
            return (
              <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                <div className="text-xl text-gray-600">Loading your goals...</div>
              </div>
            );
          }

          const weeks = getWeeksGrid();
          const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

          const ContributionGraph = ({ goalId, goalName, goalColor, isAggregate = false }) => {
            const getCount = () => {
              return Object.values(completions).filter(arr => 
                isAggregate ? arr.length > 0 : arr.includes(goalId)
              ).length;
            };

            return (
              <div className="mb-8">
                <div className="flex items-center gap-3 mb-3">
                  {!isAggregate && (
                    <div
                      className="w-5 h-5 rounded"
                      style={{ backgroundColor: goalColor }}
                    />
                  )}
                  <h3 className="text-lg font-semibold text-gray-800">{goalName}</h3>
                  <span className="text-sm text-gray-500">
                    {getCount()} {isAggregate ? 'active days' : 'days'}
                  </span>
                </div>

                <div className="bg-white p-6 rounded-lg shadow">
                  <div className="overflow-x-auto">
                    <div className="inline-block">
                      <div className="flex mb-2 ml-8">
                        {months.map((month, i) => (
                          <div
                            key={month}
                            className="text-xs text-gray-600"
                            style={{ width: `${weeks.filter(week => {
                              const firstDate = week.find(d => d);
                              return firstDate && firstDate.getMonth() === i;
                            }).length * 14}px` }}
                          >
                            {month}
                          </div>
                        ))}
                      </div>

                      <div className="flex gap-1">
                        <div className="flex flex-col gap-1 text-xs text-gray-600 pr-2">
                          <div style={{ height: '12px' }}></div>
                          <div style={{ height: '12px' }}>Mon</div>
                          <div style={{ height: '12px' }}></div>
                          <div style={{ height: '12px' }}>Wed</div>
                          <div style={{ height: '12px' }}></div>
                          <div style={{ height: '12px' }}>Fri</div>
                          <div style={{ height: '12px' }}></div>
                        </div>

                        {weeks.map((week, weekIdx) => (
                          <div key={weekIdx} className="flex flex-col gap-1">
                            {week.map((date, dayIdx) => (
                              <div
                                key={dayIdx}
                                onClick={() => handleDayClick(date)}
                                className="w-3 h-3 rounded-sm cursor-pointer hover:ring-2 hover:ring-gray-400 transition-all"
                                style={{
                                  backgroundColor: isAggregate 
                                    ? getAggregateCellColor(date)
                                    : getCellColorForGoal(date, goalId),
                                  cursor: date ? 'pointer' : 'default'
                                }}
                                title={date ? `${date.toLocaleDateString()}${isAggregate ? ` - ${(completions[getDateKey(date)] || []).length} goals` : ''}` : ''}
                              />
                            ))}
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>

                  <div className="mt-4 flex items-center gap-2 text-xs text-gray-600">
                    <span>Less</span>
                    <div className="w-3 h-3 rounded-sm" style={{ backgroundColor: '#ebedf0' }} />
                    {isAggregate ? (
                      <>
                        <div className="w-3 h-3 rounded-sm" style={{ backgroundColor: '#9be9a8' }} />
                        <div className="w-3 h-3 rounded-sm" style={{ backgroundColor: '#40c463' }} />
                        <div className="w-3 h-3 rounded-sm" style={{ backgroundColor: '#30a14e' }} />
                        <div className="w-3 h-3 rounded-sm" style={{ backgroundColor: '#216e39' }} />
                        <div className="w-3 h-3 rounded-sm" style={{ backgroundColor: '#0d4429' }} />
                      </>
                    ) : (
                      <div className="w-3 h-3 rounded-sm" style={{ backgroundColor: goalColor }} />
                    )}
                    <span>More</span>
                  </div>
                </div>
              </div>
            );
          };

          return (
            <div className="min-h-screen bg-gray-50 p-8">
              <div className="max-w-7xl mx-auto">
                <div className="mb-8 flex justify-between items-center">
                  <div>
                    <h1 className="text-4xl font-bold text-gray-900">2026 Goals Tracker</h1>
                    <p className="text-gray-600 mt-2">Click any day to track your progress across all goals</p>
                  </div>
                  <div className="flex gap-3 items-center">
                    {syncStatus && (
                      <span className="text-sm text-gray-600">{syncStatus}</span>
                    )}
                    <button
                      onClick={() => setShowSettings(!showSettings)}
                      className="px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors"
                    >
                      {showSettings ? 'Close Settings' : 'Settings'}
                    </button>
                  </div>
                </div>

                {showSettings && (
                  <div className="mb-8 space-y-6">
                    <div className="bg-white p-6 rounded-lg shadow-lg">
                      <h2 className="text-xl font-semibold mb-4">Cloud Sync</h2>
                      {!isConfigured ? (
                        <div>
                          <p className="text-gray-600 mb-4">
                            Connect GitHub to sync your data across all devices.
                          </p>
                          <button
                            onClick={setupGitHub}
                            className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"
                          >
                            Connect GitHub
                          </button>
                          <div className="mt-4 p-4 bg-blue-50 rounded text-sm text-gray-700">
                            <strong>Setup instructions:</strong>
                            <ol className="list-decimal ml-5 mt-2 space-y-1">
                              <li>Go to GitHub Settings → Developer settings → Personal access tokens → Tokens (classic)</li>
                              <li>Click "Generate new token (classic)"</li>
                              <li>Give it a name like "Goals Tracker"</li>
                              <li>Check only the "gist" permission</li>
                              <li>Click "Generate token" and copy it</li>
                              <li>Paste it here when prompted</li>
                            </ol>
                          </div>
                        </div>
                      ) : (
                        <div>
                          <p className="text-green-600 mb-4">✓ Connected to GitHub</p>
                          <button
                            onClick={disconnectGitHub}
                            className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors"
                          >
                            Disconnect
                          </button>
                        </div>
                      )}
                    </div>

                    <div className="bg-white p-6 rounded-lg shadow-lg">
                      <h2 className="text-xl font-semibold mb-4">Manage Goals</h2>
                      <div className="space-y-3 mb-4">
                        {goals.map(goal => (
                          <div key={goal.id} className="flex items-center gap-3 p-3 bg-gray-50 rounded">
                            <div
                              className="w-6 h-6 rounded flex-shrink-0"
                              style={{ backgroundColor: goal.color }}
                            />
                            <span className="flex-1 font-medium">{goal.name}</span>
                            <button
                              onClick={() => editGoalName(goal.id)}
                              className="px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded transition-colors"
                            >
                              Edit
                            </button>
                            <button
                              onClick={() => removeGoal(goal.id)}
                              className="px-3 py-1 text-sm text-red-600 hover:bg-red-50 rounded transition-colors"
                            >
                              Remove
                            </button>
                          </div>
                        ))}
                      </div>
                      <button
                        onClick={addGoal}
                        className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
                      >
                        + Add Goal
                      </button>
                    </div>
                  </div>
                )}

                <div className="mb-6">
                  <ContributionGraph 
                    goalName="All Goals Combined"
                    isAggregate={true}
                  />
                </div>

                <div className="border-t-2 border-gray-300 pt-6 mb-6">
                  <h2 className="text-2xl font-bold text-gray-800 mb-6">Individual Goals</h2>
                </div>

                {goals.map(goal => (
                  <ContributionGraph
                    key={goal.id}
                    goalId={goal.id}
                    goalName={goal.name}
                    goalColor={goal.color}
                  />
                ))}

                {selectedDate && (
                  <div className="fixed bottom-8 right-8 bg-white p-6 rounded-lg shadow-2xl border-2 border-gray-200 max-w-md">
                    <div className="flex justify-between items-start mb-4">
                      <h3 className="text-lg font-semibold">
                        {selectedDate.toLocaleDateString('en-US', { 
                          weekday: 'long', 
                          month: 'short', 
                          day: 'numeric' 
                        })}
                      </h3>
                      <button
                        onClick={() => setSelectedDate(null)}
                        className="text-gray-400 hover:text-gray-600"
                      >
                        ✕
                      </button>
                    </div>
                    <div className="space-y-2">
                      {goals.map(goal => {
                        const key = getDateKey(selectedDate);
                        const isComplete = (completions[key] || []).includes(goal.id);
                        
                        return (
                          <label
                            key={goal.id}
                            className="flex items-center gap-3 p-3 rounded hover:bg-gray-50 cursor-pointer transition-colors"
                          >
                            <input
                              type="checkbox"
                              checked={isComplete}
                              onChange={() => toggleGoal(goal.id)}
                              className="w-5 h-5 cursor-pointer"
                            />
                            <div
                              className="w-4 h-4 rounded"
                              style={{ backgroundColor: goal.color }}
                            />
                            <span className="font-medium">{goal.name}</span>
                          </label>
                        );
                      })}
                    </div>
                    <div className="mt-4 pt-4 border-t border-gray-200 text-sm text-gray-600">
                      {(completions[getDateKey(selectedDate)] || []).length} / {goals.length} goals completed
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.render(<GoalsTracker />, document.getElementById('root'));
    </script>
</body>
</html>
